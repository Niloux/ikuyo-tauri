# 背景
文件名：2025-07-07_1_rust-refactor.md
创建于：2025-07-07_22:20:00
创建者：wuyou
主分支：main
任务分支：task/rust-refactor_2025-07-07_1
Yolo模式：Off

# 任务描述
Rust后端重构：优先完善数据库层，其次接口层，最后实现异步爬虫任务系统，逐步替换原有Python端业务。

# 项目概览
本项目为番剧聚合与爬虫系统，原有后端为Python实现，现已用Rust（Tauri+Sqlite+tokio）重构核心后端，目标是实现高性能、易维护、全异步的后端服务，彻底摆脱Python依赖。

⚠️ 警告：永远不要修改此部分 ⚠️
本任务遵循RIPER-5协议，所有模式切换、计划、执行、审查均需严格记录，禁止未授权更改。
⚠️ 警告：永远不要修改此部分 ⚠️

# 分析
## 数据库相关
- 采用tauri-plugin-sql+sqlx，自动迁移，表结构规范，主外键、索引齐全。
- 需注意sqlite外键约束默认未启用，建议连接时PRAGMA开启。
- 迁移脚本与结构体需保持同步，后续变更需补充迁移。
- 建议补充数据库单元测试。

## 接口相关
- API分模块，参数与返回值类型清晰，错误处理统一。
- 部分接口为占位，需补充真实业务逻辑。
- 建议接口文档自动生成，错误码标准化。

## 爬虫任务相关
- 现有Rust端仅有占位，需用tokio自研异步爬虫任务系统。
- 需支持任务调度、worker异步抓取、进度与日志上报、数据入库。
- 推荐分层设计，解耦调度、执行、持久化。

# 提议的解决方案
1. 数据库层：补全表结构、索引、外键，补充迁移与单元测试。
2. 接口层：补全API真实逻辑，类型化参数与返回，标准化错误码，自动生成文档。
3. 爬虫任务系统：基于tokio设计异步调度与worker，支持多任务、进度上报、数据入库，逐步迁移Python端业务。
4. 集成与测试：前后端联调，全链路测试，完善文档。

# 当前执行步骤："1. 数据库层review与完善"

# 任务进度

# 最终审查
